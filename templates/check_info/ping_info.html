{% extends 'base.html' %}
{% block head %}
<title>Ping Info</title>

{% endblock head %}

{% block breadcrumb %}
    <li class="breadcrumb-item"><a href="{% url 'checkerapp:home' %}">Services</a></li>
    <li class="breadcrumb-item"><a href="{% url 'checkerapp:service' base_check.service_set.first.id %}">{{base_check.service_set.first.name}}</a></li>
    <li class="breadcrumb-item active">{{ip_address.ip_address}}</li>
{% endblock %}
{% block body %}
    <div class="container">
      <div class="row col-12">
       <div class='col-6'>
       {% if last_down_time%}
        <p>Last Down Time : {{last_down_time.created_at}}</p>
        {% else %}
        <p>Last Down Time : No down time</p>
        {% endif %}
        <p>Severe Level : {{base_check.get_severe_levele_display}}</p>
       </div>

      {% comment %} {% if user.is_superuser %} {% endcomment %}
      <div class="ml-auto dropdown">

        <form method='POST' action="{% url 'accounts:add_user_in_check' base_check.pk ip_address.pk%}">
        {% csrf_token %}
        <select class="selectpicker" name="listxblocks" multiple data-live-search="true">
        {% if not request.user.is_superuser %}
          <option>Only admin can add</option>
        {% else %}

          {% for add_user in all_users %}
            {% if add_user not in user_list %}
              <option value="{{add_user.id}}">{{add_user.username}}</option>
            {% endif %}
          {% endfor %}
        {% endif %}
        </select>

        {% if request.user.is_superuser %}
          <button type="submit" class="btn btn-primary ">Add users</button>
        {% endif %}
        </form>

      </div>
      </div>
      {% comment %} {% endif %} {% endcomment %}

      <div class="row">
      <table class="table jumbotron col-6 shadow-sm">
        <thead class="thead-inverse">
          <tr>
            <th>Status</th>
            <th>Time</th>
          </tr>
        </thead>
        {% if result %}
        <tbody>
          {% for status in result %}
            <tr>
              <td class="align-middle">{{status.get_result_display}}</td>
              <td class="align-middle">{{status.created_at}}</td>
            </tr>
          {% endfor %}
        </tbody>
        {% else %}
        <tbody>
          <tr><td>No checks</td></tr>
        </tbody>
        {% endif %}
      </table>
      <div class="col-1 "></div>
      <table class="table jumbotron col-5 shadow-sm">
      <tr class="danger">
      <th>Users</th>

      {% if request.user.is_superuser %}
      <th>Action</th>
      {% endif %}
      </tr>

      {% if user_list %}
        {% for user in user_list %}
          <tbody>
          <tr class="info">
            <td>{{user.username}}</td>
            {% if request.user.is_superuser %}
              <td><a href="{% url 'accounts:remove_user' base_check.pk ip_address.pk user.pk %}">Remove</a></td>
            {% endif %}
          </tr>
          </tbody>
        {% endfor %}
      {% else %}
        <tr><td>No users added</td></tr>
      {% endif %}

      </table>
      </div>

    {% comment %} </div> {% endcomment %}

{% if result.has_other_pages %}
  <ul class="pagination">
    {% if result.has_previous %}
      <li class="page-item"><a class="page-link" href="?page={{ result.previous_page_number }}">&laquo;</a></li>
    {% else %}
      <li class="disabled"><span></span></li>
    {% endif %}

    {% for i in result.paginator.page_range %}
      {% if i <= result.number|add:5 and i >= result.number|add:-5 %}
        {% if result.number == i %}
          <li class="page-item active page-link"><span>{{ i }} <span class="sr-only page-link">(current)</span></span></li>
        {% else %}
          <li class="page-item"><a class="page-link text-dark" href="?page={{ i }}">{{ i }}</a></li>
        {% endif %}
      {% endif %}
    {% endfor %}

    {% if result.has_next %}
      <li class="page-item"><a class="page-link" href="?page={{ result.next_page_number }}">&raquo;</a></li>
    {% else %}
      <li class="disabled"><span></span></li>
    {% endif %}
  </ul>
{% endif %}
    </div>
 </body>
{% endblock body %}
